1. Oracle

Một bài java đơn giản

z3 script:

```
from z3 import *
s=Solver()

inp=[BitVec(f'{i}',32) for i in range(42)]
for c in inp:
    s.add(c>0x20)
    s.add(c<0x7f)


for i in range(42):
    inp[i]=inp[i] ^ 3 * i * i + 5 * i + 101 + i % 2

dd=[0]*42
for i in range(42):
    dd[i]=inp[(i + 42 - 1) % 42] << 4 | (inp[i] & 0xFF) >> 4

inp=dd

for i in range(42):
    inp[i]=inp[i]+7 * i * i + 31 * i + 127 + i % 2

ck=[48, 6, 122, -86, -73, -59, 78, 84, 105, -119, -36, -118, 70, 17, 101, -85, 55, -38, -91, 32, -18, -107, 53, 99, -74, 67, 89, 120, -41, 122, -100, -70, 34, -111, 21, -128, 78, 27, 123, -103, 36, 87]
n=0
for i in range(42):
    n=n|((ck[i]^inp[i])&0xff)

s.add(n==0)
print(s.check())
if s.check()==sat:
    m=s.model()
    inp=[BitVec(f'{i}',32) for i in range(42)]
    for i in inp:
        print(chr(m[i].as_long()),end="")


```

2. Bit flipping machine

Có 2 phase nhưng sử dùng cùng 1 hàm check

Logic nó khá đơn giản:

nó cho hay string như này cần chuyển string 1 thành string 2.

nhập 1 chuỗi kí tự chỉ chấp nhận in hoa (tức từ A đến Z).

độ dài input phải &3=0.

lấy 1 lần 2 kí tự trong input.

ví dự nhập ABCD thì mỗi lần lấy AB, CD.

sau đó tính toán v31 = (v29 - 65 + 26 * (v28 - 65)) // 8 với v29 là kí tự sau, v28 là kí tự đầu (ví dụ v29='B',  v28='A').

sau đó lấy v21=st1[v31].

rồi  v21^=128 >> ((v29 - 65 + 26 * (v28 - 65)) % 8).

sau khi thực hiện xong rồi lưu lại đúng vị trí đó st2.

lưu ý các phép xor của v21 là trường hợp đặc biệt nên tương tự phép cộng.

mục đích cuối là làm cho st1 thành st2.

-->pass phase1: CNCPCQCSCTCVCXCYCZDBDDDGDHDIDLDNDODPDTDXDYDZEEEE

-->pass phase2: EEEMEPEUEXFCFFFRFTFUFVGBGCGDGJGKGL\x00\x00

phase2 khó hơn phase1 vì không tìm được cặp nào lẻ để độ dài &3==0, padd thêm 2 byte null vì hàm getline() không nhận byte null vừa thỏa điều kiện về độ dài.

3. Internprise Encryption

Bài này mình viết lại bằng python rồi brute force 

Lưu ý là file encrypt phải decrypt ra utf-16

Code brute force:

```
ef enc(s,dd,i):
    
    
    x = (s + i * 0xf) % 0x80
    if i>0:
        x+=dd%128
    else:
        x+=0xd
        
    x ^= 0x555
    x = ((x ^ ~0x0) >> 0x0) & 0xff
    if (0x2cd + ((i ^ 0x44) % 0x2 == 0)) !=0:
        x=~(x^0x3)
    else:
        x=~(x^0)
    x = ((x >> 0x1f) + x) ^ (x >> 0x1f)
    x |=  (i % 0x1)
    

    return x

ck=[251, 214, 203, 205, 107, 128, 238, 18, 214, 108, 80, 29, 155, 251, 106, 30, 214, 20, 189, 229, 23, 158, 249, 102, 114, 21, 36, 219, 55, 232, 35, 196, 33, 250, 116, 224, 199, 243, 51, 201, 62, 50, 1, 207, 102, 43, 207, 203, 58, 211, 3, 205, 22, 141, 217, 28, 132, 228, 22, 215, 122, 211, 244, 109, 41, 245, 23, 218, 23, 58, 147, 246, 41, 242, 5, 242, 111, 74, 109, 221, 200, 221, 56, 55, 208, 20, 38, 155, 130, 143, 225, 203, 43, 63, 25, 39, 41, 210, 46, 202, 56, 63, 194, 27, 143, 139, 133, 254, 55, 203, 36, 196, 41, 56, 227, 60, 211, 63, 50, 49, 219, 60, 59, 56, 6, 203, 31, 242, 127, 47, 197, 32, 149, 1, 151, 134, 162, 220, 60, 242, 35, 254, 110, 199, 3, 217, 47, 5, 249, 52, 197, 58, 64, 6, 212, 104, 6, 133, 134, 235, 31, 219, 99, 58, 228, 223, 216, 105, 26, 221, 19, 213, 243, 32, 160, 236, 29, 54, 45, 50, 12, 239, 58, 243, 14, 249, 110, 43, 12, 47, 160, 217, 213, 37, 209, 15, 209, 105, 79, 50, 255, 23, 37, 218, 107, 76, 251, 40, 149, 42, 50, 44, 42, 36, 232, 200, 253, 12, 240, 8, 243, 126, 77, 108, 6, 136, 157, 247, 215, 204, 17, 40, 156, 142, 156, 226, 51, 44, 63, 202, 23, 142, 131, 157, 250, 21, 133, 184, 228, 110, 30, 159, 252, 21, 184, 53, 253, 95, 195, 247, 4, 199, 50, 43, 54, 245, 46, 236, 61, 10, 151, 241, 104, 102, 62, 250, 64, 51, 208, 39, 135, 207, 97, 64, 243, 47, 206, 23, 137, 205, 110, 13, 225, 220, 45, 194, 40, 46, 60, 16, 238, 45, 239, 57, 213, 126, 75, 1, 42, 205, 241, 39, 242, 31, 198, 243, 65, 17, 190, 251, 79, 24, 242, 126, 72, 219, 194, 251, 50, 49, 212, 52, 57, 10, 150, 132, 139, 159, 252, 101, 17, 221, 125, 213, 53, 229, 37, 193, 52, 51, 253, 26, 155, 145, 238, 5, 41, 223, 98, 204, 251, 62, 247, 9, 231, 196, 212, 32, 144, 190, 40, 199, 222, 15, 245, 40, 57, 218, 12, 130, 146, 240, 98, 18, 156, 50, 145, 153, 225, 37, 196, 60, 202, 219, 57, 234, 59, 220, 104, 60, 230, 97, 114, 219, 221, 23, 253, 96, 20, 218, 105, 76, 58, 201, 212, 62, 152, 222, 121, 65, 237, 18, 157, 254, 100, 20, 132, 220, 206, 55, 33, 157, 253, 105, 223, 122, 93, 206, 246, 103, 54, 220, 204, 29, 58, 197, 244, 36, 252, 7, 45, 59, 16, 186, 222, 211, 219, 35, 198, 227, 99, 104, 193, 255, 64, 207, 255, 86, 102, 196, 105, 80, 243, 56, 206, 56, 202, 197, 29, 253, 57, 239, 39, 143, 228, 26, 219, 2, 232, 45, 64, 206, 38, 216, 215, 102, 125, 89, 212, 224, 35, 151, 240, 22, 213, 54, 232, 214, 197, 226, 25, 199, 216, 103, 32, 147, 160, 194, 16, 236, 35, 63, 221, 218, 213, 38, 50, 48, 61, 8, 211, 58, 245, 50, 221, 128, 243, 124, 79, 46, 225, 221, 37, 196, 33, 222, 214, 246, 41, 225, 19, 250, 105, 218, 19, 48, 155, 157, 199, 214, 40, 218, 19, 154, 37, 129, 165, 234, 63, 34, 217, 105, 125, 24, 244, 72, 2, 158, 245, 122, 53, 30, 242, 40, 237, 49, 222, 203, 27, 37, 255, 37, 160, 228, 63, 22, 196, 14, 209, 104, 43, 44, 201, 58, 152, 215, 20, 40, 158, 234, 98, 56, 212, 247, 116, 89, 55, 194, 17, 238, 19, 197, 50, 6, 161, 202, 241, 10, 147, 40, 35, 35, 10, 233, 220, 42, 243, 7, 255, 127, 55, 148, 137, 1, 154, 229, 14, 191, 52, 4, 175, 238, 43, 246, 105, 196, 14, 224, 121, 46, 235, 33, 35, 218, 4, 206, 111, 14, 45, 233, 55, 213, 15, 204, 3, 161, 214, 9, 166, 39, 207, 51, 36, 51, 3, 240, 77, 199, 33, 199, 9, 144, 44, 145, 132, 132, 198, 205, 45, 236, 113, 223, 9, 182, 194, 212, 10, 248, 117, 72, 225, 4, 135, 149, 242, 22, 132, 224, 114, 27, 155, 151, 255, 86, 17, 211, 103, 198, 252, 74, 224, 64, 57, 51, 4, 162, 204, 45, 231, 49, 43, 215, 21, 43, 15, 1, 179, 247, 28, 220, 214, 201, 203, 6, 177, 201, 33, 130, 166, 129, 251, 91, 219, 221, 45, 10, 252, 119, 80, 102, 14, 214, 221, 35, 198, 14, 222, 113, 90, 197, 202]


fl=""
for i in range(len(ck)):
    if i==len(ck)-1:
        break
    for ch in range(0x20,0x7f):
        if enc(ch,ck[i],i+1)==ck[i+1]:
            fl+=chr(ch)

print(fl)
```

4. 







