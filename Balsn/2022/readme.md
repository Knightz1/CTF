## 1. Propaganda

Đề cho 3 file: `launcher.js`, `run.py` và `propaganda.wasm`

-file `run.py` dùng để chạy file `launcher.js` bằng `node` và `launcher.js` load và compile file `propaganda.wasm` 

-Chương trình gộp 8 byte flag thành 1 số 64 bit (little-endian) vồi đưa vô hàm `f` trong `propaganda.wasm`

-Dùng `wasm2c` của `wabt` để decompile wasm thành code c rồi sau đó compile thành file ELF bằng gcc để tiện cho việc debug

-Đưa vào IDA và tìm hàm f dưới tên `w2c_f`:

![image](https://user-images.githubusercontent.com/91442807/188601432-ddfc8a66-e992-4566-ab01-a24ed62cba3e.png)

-Quan sát và phân tích ta thấy:

  +Hàm sẽ chạy 1 vòng lặp 0x12C lần trong đó gồm 2 vòng lặp nhỏ v8 và v6 và input mình đưa vào tại indirect function thông qua `call rdx` rồi lấy kết quả đưa tiếp vào hàm như vậy và lặp lại tiếp tục ...
  
  +Search trên mạng `call indirect` trong wasm thì nó sẽ lấy hàm trong danh sách hàm được gọi là table theo offset nào đó nên mình search table trong wasm2c code và thấy `init_table`:
  
  ![image](https://user-images.githubusercontent.com/91442807/188603723-7196d781-a110-4404-8968-d3073d119e71.png)

  +Trong khi debug thì mình thấy hàm quyết định offset của function tại `v11`
  
  +Tới đây mình viết 1 script để đặt bp tại v11, v8, v6 để dump các giá trị đó ra 
  
```python
base=0x0000555555554000

import gdb

info=[]
gdb.execute("file ./abcdef")


#TEST FUNC RESULT

gdb.execute("b *0x5555555609B2")
gdb.execute("r")
gdb.execute("set $rdi=0x7b")

gdb.execute("b *0x555555560A40")
gdb.execute("c")
gdb.execute("set *(int64_t *)0x5555555900A0=0x555555590101")


for i in range(0x12c):
    gdb.execute("b *0x555555564F85")        #if 
    gdb.execute("c")
    v7=gdb.parse_and_eval("$rax")

    gdb.execute("b *0x555555564FDB")        #for
    gdb.execute("c")
    v6=gdb.parse_and_eval("$rax")

    gdb.execute("b *0x555555565027")        #func
    gdb.execute("c")
    v11=gdb.parse_and_eval("$rax")
    
    v8=-1
    if v7-1>=7:
        gdb.execute("b *0x555555565080")        #while
        gdb.execute("c")
        v8=gdb.parse_and_eval("$rax")


    info.append([hex(v11), hex(v8), hex(v6)])

print(info)
```
-Kết quả:
```python
order=[['0x13', '0xffffffe0', '0x5'], ['0xc', '0xffffffc8', '0x6'], ['0x1a', '-0x1', '0x1'], ['0x14', '0xffffff78', '0x7'], ['0x1', '0xffffff78', '0x5'], ['0xd', '0xffffffb0', '0x6'], ['0xb', '0xffffff38', '0x1'], ['0x1c', '0xffffff30', '0x6'], ['0x14', '0xffffffa0', '0x0'], ['0x13', '0xffffff50', '0x5'], ['0x1c', '0xffffff70', '0x2'], ['0x3', '0xffffff78', '0x3'], ['0x1c', '0xffffffe8', '0x7'], ['0x18', '0xffffffa0', '0x2'], ['0x18', '0xffffff28', '0x2'], ['0xa', '0xffffff98', '0x6'], ['0x10', '0xffffff98', '0x5'], ['0x1e', '0xffffff70', '0x1'], ['0xd', '0xffffffd0', '0x4'], ['0x19', '0xfffffff8', '0x7'], ['0xe', '0xffffffe8', '0x5'], ['0x2', '0xffffff10', '0x2'], ['0x1e', '0xfffffee0', '0x4'], ['0x9', '0xfffffee8', '0x2'], ['0x11', '0xfffffed8', '0x1'], ['0x18', '0xffffffe0', '0x4'], ['0xb', '0xffffff60', '0x4'], ['0x6', '0xffffff50', '0x5'], ['0xa', '0xfffffff0', '0x4'], ['0x16', '0xffffff60', '0x2'], ['0x2', '0xffffff08', '0x6'], ['0x7', '0xffffffc0', '0x1'], ['0x7', '0xffffff08', '0x1'], ['0x1e', '0xfffffef0', '0x0'], ['0x12', '0xffffffa0', '0x0'], ['0x15', '0xfffffee8', '0x5'], ['0x6', '0xffffff58', '0x0'], ['0x1e', '0xffffff40', '0x7'], ['0x17', '0xfffffee0', '0x5'], ['0x13', '0xffffffc8', '0x0'], ['0x14', '0xffffff70', '0x3'], ['0x7', '0xffffff20', '0x6'], ['0x11', '0xffffff30', '0x0'], ['0xa', '0xfffffff0', '0x2'], ['0x1', '0xffffff98', '0x5'], ['0x8', '0xffffffa8', '0x3'], ['0x1e', '0xffffff90', '0x0'], ['0x7', '-0x1', '0x5'], ['0x12', '0xffffff60', '0x1'], ['0x1d', '0xffffff48', '0x0'], ['0x1b', '0xffffff28', '0x4'], ['0x15', '0xffffff48', '0x4'], ['0x1', '0xffffffa8', '0x1'], ['0xa', '0xffffffa8', '0x4'], ['0x1c', '0xffffffb8', '0x2'], ['0x2', '0xfffffed8', '0x3'], ['0x18', '0xffffff78', '0x5'], ['0x5', '0xffffffb8', '0x4'], ['0x19', '0xffffff98', '0x5'], ['0x1e', '0xffffffb8', '0x4'], ['0x9', '0xffffffe8', '0x7'], ['0x18', '0xffffff68', '0x6'], ['0x4', '0xffffff98', '0x3'], ['0x10', '0xffffffe8', '0x3'], ['0x1e', '0xffffff20', '0x3'], ['0x1b', '0xffffff88', '0x6'], ['0x17', '0xffffff40', '0x5'], ['0x8', '0xfffffee0', '0x5'], ['0x10', '0xfffffff0', '0x6'], ['0xf', '0xffffff58', '0x3'], ['0x10', '0xfffffed8', '0x1'], ['0x2', '0xffffff28', '0x2'], ['0x1', '0xffffffd8', '0x0'], ['0x1b', '0xffffffd0', '0x5'], ['0x1c', '0xffffff28', '0x3'], ['0x7', '0xfffffef0', '0x4'], ['0x7', '0xfffffef8', '0x2'], ['0x6', '0xffffff18', '0x5'], ['0x1a', '0xffffff88', '0x7'], ['0x8', '0xffffff50', '0x0'], ['0xc', '0xfffffff0', '0x1'], ['0x19', '0xffffff10', '0x3'], ['0x13', '0xffffff90', '0x4'], ['0x1d', '0xfffffee8', '0x3'], ['0x13', '0xffffffc8', '0x0'], ['0x15', '0xffffff90', '0x4'], ['0x15', '0xffffffb0', '0x2'], ['0x1e', '0xffffffd8', '0x7'], ['0x3', '0xffffff58', '0x5'], ['0x19', '0xffffff68', '0x0'], ['0x1d', '0xfffffed8', '0x2'], ['0x11', '0xffffff88', '0x3'], ['0x7', '0xffffff18', '0x4'], ['0x1', '0xffffff70', '0x4'], ['0xb', '0xffffff48', '0x5'], ['0xc', '0xfffffed8', '0x3'], ['0x16', '0xffffff90', '0x2'], ['0x11', '0xffffffa8', '0x5'], ['0xe', '0xffffff90', '0x6'], ['0x4', '0xffffff08', '0x4'], ['0xa', '0xfffffff8', '0x3'], ['0xd', '0xffffff60', '0x4'], ['0x1a', '0xffffff60', '0x6'], ['0x1e', '0xffffff78', '0x3'], ['0x14', '0xffffff08', '0x1'], ['0xe', '0xffffffb0', '0x3'], ['0x18', '0xfffffff0', '0x5'], ['0xf', '0xffffffd8', '0x0'], ['0x6', '0xffffff10', '0x0'], ['0x18', '0xffffff28', '0x7'], ['0x16', '0xffffff38', '0x5'], ['0x16', '0xffffffa8', '0x1'], ['0x8', '-0x1', '0x6'], ['0xc', '0xffffffe8', '0x6'], ['0x1c', '0xffffff48', '0x3'], ['0x6', '0xffffff08', '0x1'], ['0x10', '0xffffffe8', '0x6'], ['0x10', '0xffffffe0', '0x3'], ['0x19', '0xffffffd0', '0x0'], ['0x5', '0xfffffee8', '0x0'], ['0x14', '0xffffffd0', '0x0'], ['0xe', '0xffffffe8', '0x7'], ['0x15', '0xffffff90', '0x6'], ['0x14', '0xffffff30', '0x4'], ['0x10', '0xffffffc8', '0x3'], ['0x7', '0xffffffc8', '0x0'], ['0x15', '0xffffff70', '0x3'], ['0x4', '0xffffff20', '0x3'], ['0x18', '0xfffffee0', '0x3'], ['0x7', '0xffffff48', '0x3'], ['0xb', '0xfffffef8', '0x5'], ['0x3', '0xffffff10', '0x5'], ['0x6', '0xffffff60', '0x2'], ['0xf', '0xffffffc0', '0x3'], ['0x1b', '0xffffff60', '0x3'], ['0x6', '0xfffffef8', '0x4'], ['0x14', '0xffffffe8', '0x7'], ['0x17', '0xfffffef8', '0x5'], ['0x12', '0xfffffef8', '0x3'], ['0x1e', '0xffffffc0', '0x4'], ['0x1', '0xffffffd8', '0x6'], ['0x1d', '0xffffff10', '0x2'], ['0x9', '0xffffff20', '0x4'], ['0x18', '0xfffffee8', '0x6'], ['0xb', '0xfffffef0', '0x2'], ['0xb', '0xffffff18', '0x2'], ['0x14', '0xffffff60', '0x5'], ['0x14', '0xfffffff0', '0x6'], ['0xd', '0xffffff38', '0x0'], ['0x9', '0xffffff28', '0x3'], ['0xd', '0xfffffee8', '0x1'], ['0x4', '-0x1', '0x4'], ['0x12', '0xffffffa0', '0x3'], ['0x1c', '0xffffffd0', '0x3'], ['0x2', '0xffffff58', '0x1'], ['0x1b', '0xffffffa8', '0x5'], ['0x4', '0xfffffef0', '0x5'], ['0x8', '0xffffff80', '0x2'], ['0xa', '0xffffff78', '0x1'], ['0xb', '0xfffffef0', '0x2'], ['0x5', '0xfffffee0', '0x6'], ['0x19', '0xffffffd8', '0x4'], ['0x7', '0xffffff10', '0x6'], ['0x11', '0xffffffd0', '0x2'], ['0x1e', '0xffffffb0', '0x2'], ['0x5', '0xffffff90', '0x3'], ['0x18', '0xfffffee0', '0x5'], ['0x5', '0xfffffff0', '0x4'], ['0xb', '0xffffff98', '0x0'], ['0xd', '0xffffff98', '0x0'], ['0x17', '0xffffff90', '0x6'], ['0x14', '0xffffff90', '0x3'], ['0x7', '0xffffffd8', '0x7'], ['0x2', '0xffffff00', '0x1'], ['0x1a', '0xffffff50', '0x3'], ['0x13', '0xffffffd0', '0x4'], ['0xb', '0xffffff08', '0x2'], ['0x10', '0xffffff70', '0x7'], ['0x5', '0xfffffed8', '0x0'], ['0x9', '0xffffffd8', '0x2'], ['0x6', '0xfffffef0', '0x3'], ['0x6', '0xffffff70', '0x6'], ['0x1', '0xffffff80', '0x2'], ['0x16', '0xffffffb8', '0x7'], ['0x14', '0xfffffee8', '0x4'], ['0x9', '0xfffffef0', '0x0'], ['0x1a', '0xffffff20', '0x2'], ['0x1a', '0xffffffd0', '0x6'], ['0x14', '0xfffffee0', '0x2'], ['0x15', '0xffffff68', '0x5'], ['0xf', '0xffffff20', '0x7'], ['0x6', '0xffffff60', '0x4'], ['0x16', '0xffffffb0', '0x0'], ['0xb', '0xffffffa0', '0x5'], ['0xe', '-0x1', '0x6'], ['0x16', '0xffffff88', '0x5'], ['0x10', '0xffffffd0', '0x4'], ['0x10', '-0x1', '0x6'], ['0x10', '0xffffffd8', '0x3'], ['0x1d', '0xffffff30', '0x3'], ['0x8', '0xffffff70', '0x6'], ['0x1d', '-0x1', '0x6'], ['0x11', '0xfffffed8', '0x2'], ['0x17', '0xffffff48', '0x3'], ['0x3', '0xffffffd0', '0x0'], ['0x17', '0xffffff20', '0x7'], ['0x1b', '0xffffffb0', '0x6'], ['0x4', '0xfffffff0', '0x2'], ['0xe', '0xfffffff8', '0x1'], ['0x1', '0xffffff98', '0x6'], ['0xb', '0xffffff10', '0x3'], ['0x12', '-0x1', '0x6'], ['0x12', '0xfffffff0', '0x6'], ['0x11', '0xffffffb8', '0x3'], ['0x5', '0xfffffee8', '0x3'], ['0x15', '0xfffffef8', '0x2'], ['0x3', '0xffffff90', '0x2'], ['0xd', '0xffffffb8', '0x2'], ['0x5', '0xffffff98', '0x3'], ['0xf', '0xfffffed8', '0x1'], ['0x18', '0xfffffed8', '0x4'], ['0x1d', '0xffffffe0', '0x3'], ['0x12', '0xffffff78', '0x4'], ['0x14', '0xfffffef8', '0x0'], ['0xc', '0xfffffee0', '0x4'], ['0x1a', '0xfffffef0', '0x3'], ['0xc', '0xffffffd8', '0x4'], ['0x12', '0xffffffe8', '0x7'], ['0x14', '0xffffff20', '0x6'], ['0x2', '0xffffff70', '0x6'], ['0xb', '0xffffff60', '0x2'], ['0xa', '0xffffff08', '0x6'], ['0x1d', '0xffffffe0', '0x3'], ['0x1e', '0xfffffef8', '0x2'], ['0x1e', '0xffffffc0', '0x2'], ['0x17', '0xffffff58', '0x2'], ['0x2', '0xffffff50', '0x6'], ['0x1d', '0xffffff20', '0x0'], ['0x1d', '0xfffffef0', '0x4'], ['0x14', '0xffffffa8', '0x1'], ['0x12', '0xfffffef8', '0x7'], ['0x8', '0xffffff28', '0x6'], ['0x10', '0xffffff70', '0x3'], ['0x12', '-0x1', '0x5'], ['0xa', '0xffffffd0', '0x6'], ['0xf', '0xffffff20', '0x7'], ['0x5', '0xffffff90', '0x1'], ['0xf', '0xfffffef0', '0x2'], ['0x8', '0xffffffe0', '0x5'], ['0xd', '0xffffff88', '0x2'], ['0x6', '0xffffff98', '0x7'], ['0x16', '0xffffff18', '0x4'], ['0x5', '0xfffffed8', '0x1'], ['0x16', '0xffffffc8', '0x3'], ['0x14', '0xffffff30', '0x3'], ['0x3', '0xffffff18', '0x5'], ['0x19', '0xffffffe0', '0x6'], ['0xe', '0xffffffb0', '0x1'], ['0x8', '0xffffff80', '0x1'], ['0x18', '0xffffffe0', '0x0'], ['0x18', '0xffffff20', '0x4'], ['0x5', '0xffffffc0', '0x0'], ['0x10', '0xfffffef0', '0x1'], ['0x1d', '0xffffff38', '0x2'], ['0x1a', '0xffffff68', '0x7'], ['0x14', '0xfffffef8', '0x4'], ['0x8', '0xffffff40', '0x5'], ['0xc', '0xffffff40', '0x1'], ['0x13', '0xffffffa8', '0x0'], ['0x2', '0xffffff90', '0x2'], ['0x1e', '0xfffffff0', '0x2'], ['0x12', '0xffffffe0', '0x2'], ['0x11', '0xffffff78', '0x0'], ['0x12', '0xffffffd0', '0x5'], ['0xe', '0xfffffed8', '0x2'], ['0x17', '0xffffff78', '0x7'], ['0x1d', '0xffffffb8', '0x5'], ['0x19', '0xffffff70', '0x4'], ['0x17', '0xffffff08', '0x5'], ['0x16', '0xffffff38', '0x0'], ['0x7', '0xfffffee8', '0x7'], ['0x10', '0xffffffa8', '0x2'], ['0x1a', '0xffffffe0', '0x7'], ['0x1c', '0xffffff98', '0x6'], ['0x1b', '0xffffff98', '0x3'], ['0x14', '0xffffff28', '0x3'], ['0x1e', '0xffffff90', '0x7'], ['0x10', '-0x1', '0x7'], ['0x1c', '0xfffffed8', '0x0'], ['0x8', '0xffffff70', '0x1'], ['0xf', '0xffffff00', '0x2'], ['0x6', '0xffffffe8', '0x1'], ['0x6', '0xfffffff0', '0x1'], ['0xd', '0xffffffd0', '0x2'], ['0xb', '0xffffff58', '0x7'], ['0x1c', '0xffffffa0', '0x7'], ['0x8', '0xffffffe0', '0x7'], ['0x1d', '0xffffff70', '0x0'], ['0x1b', '0xfffffff8', '0x0'], ['0x1a', '0xffffff78', '0x6']]
```

